<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Liste des Fournisseurs</title>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="p-4">

<div class="container">
  <h1 class="mb-4">Liste des Fournisseurs</h1>

  <button class="btn btn-warning" onclick="ecouterNumeroLigne()" style="margin:5px;">
      ðŸŽ¤
  </button>
  <!-- Barre de recherche -->
  <div class="mb-3">
    <input type="text" id="searchInput" class="form-control" placeholder="Rechercher un fournisseur...">
  </div>

  <!-- Tableau des fournisseurs -->
  <table class="table table-bordered table-striped" id="fournisseurTable">
    <thead class="table-dark">
      <tr>
        <th>Nom complet</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      <!-- Les fournisseurs seront ajoutÃ©s ici par JavaScript -->
    </tbody>
  </table>
</div>

<!-- Bootstrap JS Bundle -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
    
function ouvrirPopup(url, titre) {
    const iframe = document.getElementById("popupFrame");
    const title = document.getElementById("popupTitle");

    iframe.src = url;
    title.innerText = titre;

    const modal = new bootstrap.Modal(
        document.getElementById("popupModal")
    );
    modal.show();
}

document.addEventListener("DOMContentLoaded", () => {

    const tbody = document.querySelector("#fournisseurTable tbody");
    const searchInput = document.getElementById("searchInput");
    let fournisseurs = [];

    // Nom du Tsena Ã  filtrer
    const nom_tsena_filtre = "";

    // Fonction pour afficher les fournisseurs (avec filtre)
    function renderFournisseurs(filter = "") {
        tbody.innerHTML = "";

        // Filtre par fullname (input) ET description = nom_tsena_filtre
        const filtered = fournisseurs
            .filter(f => f.fullname.toLowerCase().includes(filter.toLowerCase()))
            .filter(f => f.description === nom_tsena_filtre);

        if (filtered.length === 0) {
            const tr = document.createElement("tr");
            tr.innerHTML = `<td colspan="2" class="text-center">Aucun fournisseur trouvÃ©</td>`;
            tbody.appendChild(tr);
        } else {
            filtered.forEach(f => {
                const tr = document.createElement("tr");
                tr.innerHTML = `
                    <td>${f.firstname}</td>
                    <td>
                        <button class="btn btn-primary btn-sm" onclick="choisirFournisseur('${f.firstname}')">Choisir</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }
    }

    // Fetch des fournisseurs depuis Flask
   // const idPointOfSale = 180188;
    //const url = `http://127.0.0.1:5000/get_stock?id_point_of_sale=${idPointOfSale}`;
    const url = `http://127.0.0.1:5000/get_toto`;
    fetch(url)
        .then(response => response.json())
        .then(data => {
            console.log("RÃ©ponse API complÃ¨te :", data);
            //fournisseurs = Array.isArray(data.list) ? data.list : [];
            //renderFournisseurs(); // Affiche uniquement ceux du Tsena filtrÃ©
        })
        .catch(err => console.error("Erreur chargement fournisseurs :", err));

    // Filtre au clavier (fullname)
    searchInput.addEventListener("input", () => {
        renderFournisseurs(searchInput.value);
    });
});

// Fonction pour gÃ©rer le clic sur "Choisir"
function choisirFournisseur(firstname) {
    alert("Fournisseur choisi : " + firstname);
    // Ici tu peux remplir un formulaire ou stocker la valeur
}
</script>

<!-- MODAL GENERIQUE -->
<div class="modal fade" id="popupModal" tabindex="-1">
  <div class="modal-dialog modal-xl modal-dialog-centered">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title" id="popupTitle"></h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body p-0" style="height:70vh">
        <iframe
          id="popupFrame"
          style="width:100%; height:100%; border:none;">
        </iframe>
      </div>

    </div>
  </div>
</div>
</body>
</html>
